(function (d) {

    var cfg = {
        uid: '5128c443-547c-4b66-8ea8-18b05f7c43d3',
domain: 'vats515743.megapbx.ru',
mediaPath: 'https://vats515743.megapbx.ru',
wsHost: 'vats515743.megapbx.ru',
enabled: true,
widgetcode: '2',
callbutton: 'bottom-right',
colors: '{"button":"#fe453d","text":"#ffffff","popup":"#721777"}',
calldirection: '["ru"]',
targetOfftime: 'true',
timerseconds: 26,
html: '<noindex><div class="itlcb-call-btn" id="itlcb-call-btn"></div><div id="itlcb-bg-fill" class="itlcb-background-fill"></div><div class="itlcb-widget-body" id="itlcb-step2">   <button class="itlcb-close-cross" type="btn" id="itlcb-close-btn"></button>   <div class="itlcb-widget-align">       <div class="itlcb-top-panel"><div>Перезвоним бесплатно</br>за&nbsp;26&nbsp;секунд</div>       </div>       <div class="itlcs-call-time-block" id="itlcb-postpone-common-msg">           <span id="itlcb-postpone-common-span-msg"></span>       </div>       <div class="itlcb-main-call-panell">           <div class="itlcb-panell-text" id="itlcb-postpone-msg"><span id="itlcb-postpone-msg-span">Перезвоним бесплатно</br>за&nbsp;26&nbsp;секунд</span>           </div>           <div class="itlcb-panell-body">               <div class="itlcb-input-block">               <div id="itlcb-flags-wrapper" class="itlcb-flags">                   <div tabindex="10" id="itlcb-flag-selected-wrapper" class="itlcb-selected-flag">                       <div id="itlcb-flag-selected" class="itlcb-flag"></div>                   </div>               </div>                   <input type="tel" class="itlcb-phone-input" id="itlcb-input" name="phone"/>                   <ul tabindex="11" id="itlcb-flags-list" class="itlcb-flags-list"></ul>               </div>               <div class="itlcb-button-block">                   <button class="itlcb-form-call-btn itlcb-btn-disabled" type="button" id="itlcb-do-call">                       <span class="itlcb-form-call-btn-text">ЖДУ ЗВОНКА</span>                   </button>               </div>           </div>       </div>       <div class="itlcb-bottom-txt"><span>Виджет</span> <a href="https://vats.megafon.ru?utm_source=vats&utm_medium=callback&utm_campaign=customerwebsite" target="_blank" rel="noopener noreferrer nofollow">Виртуальной АТС МегаФон</a></div>   </div>   <noindex><div class="itlcb-bottom-txt-block"><span>Виджет</span> <a href="https://vats.megafon.ru?utm_source=vats&utm_medium=callback&utm_campaign=customerwebsite" target="_blank" rel="noopener noreferrer nofollow">Виртуальной АТС МегаФон</a></div></noindex></div><div class="itlcb-call-info-block" id="itlcb-step3">   <button class="itlcb-close-cross" type="btn" id="itlcb-close-btn2"></button>   <div class="itlcb-widget-align">       <div class="itlcb-message-block" id="itlcb-info">           <div class="itlcb-message-warn">Мы уже звоним вам!</div>           <div class="itlcb-message-timer" id="itlcb-timer"></div>       </div>       <div class="itlcb-bottom-txt"><span>Виджет</span> <a href="https://vats.megafon.ru?utm_source=vats&utm_medium=callback&utm_campaign=customerwebsite" target="_blank" rel="noopener noreferrer nofollow">Виртуальной АТС МегаФон</a></div>   </div>   <div class="itlcb-bottom-txt-block"><span>Виджет</span> <a href="https://vats.megafon.ru?utm_source=vats&utm_medium=callback&utm_campaign=customerwebsite" target="_blank" rel="noopener noreferrer nofollow">Виртуальной АТС МегаФон</a></div></div><div class="itlcb-call-info-block" id="itlcb-step4">   <button class="itlcb-close-cross" type="btn" id="itlcb-close-btn3"></button>   <div class="itlcb-widget-align" id="itlcb-msg-wrap">       <div class="itlcb-message-image" id="itlcb-msg-image"></div>       <div class="itlcb-message-data" id="itlcb-info-msg"></div>       <div class="itlcb-bottom-txt"><span>Виджет</span> <a href="https://vats.megafon.ru?utm_source=vats&utm_medium=callback&utm_campaign=customerwebsite" target="_blank" rel="noopener noreferrer nofollow">Виртуальной АТС МегаФон</a></div>   </div>   <div class="itlcb-bottom-txt-block"><span>Виджет</span> <a href="https://vats.megafon.ru?utm_source=vats&utm_medium=callback&utm_campaign=customerwebsite" target="_blank" rel="noopener noreferrer">Виртуальной АТС МегаФон</a></div></div></noindex>',
selectedCountryCode: 'ru',
phonePattern: '+7(___)___-__-__',
countriesList: [{"regionCode":"150","region":"europe","countries":[{"isoCode":"ad","phoneCode":"376","phonePattern":"+376-___-___"},{"isoCode":"al","phoneCode":"355","phonePattern":"+355(___)___-___"},{"isoCode":"at","phoneCode":"43","phonePattern":"+43(___)___-____"},{"isoCode":"ba","phoneCode":"387","phonePattern":"+387-__-____"},{"isoCode":"be","phoneCode":"32","phonePattern":"+32(___)___-___"},{"isoCode":"bg","phoneCode":"359","phonePattern":"+359(___)___-___"},{"isoCode":"by","phoneCode":"375","phonePattern":"+375(__)___-__-__"},{"isoCode":"ch","phoneCode":"41","phonePattern":"+41-__-___-____"},{"isoCode":"cz","phoneCode":"420","phonePattern":"+420(___)___-___"},{"isoCode":"de","phoneCode":"49","phonePattern":"+49-___-___"},{"isoCode":"dk","phoneCode":"45","phonePattern":"+45-__-__-__-__"},{"isoCode":"ee","phoneCode":"372","phonePattern":"+372-___-____"},{"isoCode":"es","phoneCode":"34","phonePattern":"+34(___)___-___"},{"isoCode":"fi","phoneCode":"358","phonePattern":"+358(___)___-__-__"},{"isoCode":"fr","phoneCode":"33","phonePattern":"+33(___)___-___"},{"isoCode":"fr","phoneCode":"262","phonePattern":"+262-_____-____"},{"isoCode":"fr","phoneCode":"508","phonePattern":"+508-__-____"},{"isoCode":"fr","phoneCode":"590","phonePattern":"+590(___)___-___"},{"isoCode":"gr","phoneCode":"30","phonePattern":"+30(___)___-____"},{"isoCode":"hr","phoneCode":"385","phonePattern":"+385-__-___-___"},{"isoCode":"hu","phoneCode":"36","phonePattern":"+36(___)___-___"},{"isoCode":"ie","phoneCode":"353","phonePattern":"+353(___)___-___"},{"isoCode":"is","phoneCode":"354","phonePattern":"+354-___-____"},{"isoCode":"it","phoneCode":"39","phonePattern":"+39(___)____-___"},{"isoCode":"li","phoneCode":"423","phonePattern":"+423(___)___-____"},{"isoCode":"lt","phoneCode":"370","phonePattern":"+370(___)__-___"},{"isoCode":"lu","phoneCode":"352","phonePattern":"+352(___)___-___"},{"isoCode":"lv","phoneCode":"371","phonePattern":"+371-__-___-___"},{"isoCode":"mc","phoneCode":"377","phonePattern":"+377-__-___-___"},{"isoCode":"md","phoneCode":"373","phonePattern":"+373-____-____"},{"isoCode":"me","phoneCode":"382","phonePattern":"+382-__-___-___"},{"isoCode":"mk","phoneCode":"389","phonePattern":"+389-__-___-___"},{"isoCode":"mt","phoneCode":"356","phonePattern":"+356-____-____"},{"isoCode":"nl","phoneCode":"31","phonePattern":"+31-__-___-____"},{"isoCode":"no","phoneCode":"47","phonePattern":"+47(___)__-___"},{"isoCode":"pl","phoneCode":"48","phonePattern":"+48(___)___-___"},{"isoCode":"pt","phoneCode":"351","phonePattern":"+351-__-___-____"},{"isoCode":"ro","phoneCode":"40","phonePattern":"+40-__-___-____"},{"isoCode":"rs","phoneCode":"381","phonePattern":"+381-__-___-____"},{"isoCode":"ru","phoneCode":"7","phonePattern":"+7(___)___-__-__"},{"isoCode":"se","phoneCode":"46","phonePattern":"+46-__-___-____"},{"isoCode":"si","phoneCode":"386","phonePattern":"+386-__-___-___"},{"isoCode":"sk","phoneCode":"421","phonePattern":"+421(___)___-___"},{"isoCode":"sm","phoneCode":"378","phonePattern":"+378-____-______"},{"isoCode":"ua","phoneCode":"380","phonePattern":"+380(__)___-__-__"},{"isoCode":"gb","phoneCode":"44","phonePattern":"+44-__-____-____"},{"isoCode":"va","phoneCode":"396698","phonePattern":"+39-6-698-_____"}]},{"regionCode":"142","region":"asia","countries":[{"isoCode":"ae","phoneCode":"971","phonePattern":"+971-_-___-____","additional":"+971-5_-___-____"},{"isoCode":"af","phoneCode":"93","phonePattern":"+93-__-___-____"},{"isoCode":"am","phoneCode":"374","phonePattern":"+374-__-___-___"},{"isoCode":"az","phoneCode":"994","phonePattern":"+994-__-___-__-__"},{"isoCode":"bd","phoneCode":"880","phonePattern":"+880-__-___-___"},{"isoCode":"bh","phoneCode":"973","phonePattern":"+973-____-____"},{"isoCode":"bn","phoneCode":"673","phonePattern":"+673-___-____"},{"isoCode":"bt","phoneCode":"975","phonePattern":"+975-_-___-___"},{"isoCode":"cn","phoneCode":"86","phonePattern":"+86(___)____-___"},{"isoCode":"cy","phoneCode":"357","phonePattern":"+357-__-___-___"},{"isoCode":"ge","phoneCode":"995","phonePattern":"+995(___)___-___"},{"isoCode":"id","phoneCode":"62","phonePattern":"+62-__-___-__"},{"isoCode":"il","phoneCode":"972","phonePattern":"+972-_-___-____"},{"isoCode":"in","phoneCode":"91","phonePattern":"+91(____)___-___"},{"isoCode":"iq","phoneCode":"964","phonePattern":"+964(___)___-____"},{"isoCode":"ir","phoneCode":"98","phonePattern":"+98(___)___-____"},{"isoCode":"jo","phoneCode":"962","phonePattern":"+962-_-____-____"},{"isoCode":"jp","phoneCode":"81","phonePattern":"+81(___)___-___"},{"isoCode":"kg","phoneCode":"996","phonePattern":"+996(___)___-___"},{"isoCode":"kh","phoneCode":"855","phonePattern":"+855-__-___-___"},{"isoCode":"kp","phoneCode":"850","phonePattern":"+850-___-___"},{"isoCode":"kr","phoneCode":"82","phonePattern":"+82-__-___-____"},{"isoCode":"kw","phoneCode":"965","phonePattern":"+965-____-____"},{"isoCode":"kz","phoneCode":"77","phonePattern":"+7(7__)___-__-__"},{"isoCode":"kz","phoneCode":"76","phonePattern":"+7(6__)___-__-__"},{"isoCode":"la","phoneCode":"856","phonePattern":"+856-__-___-___"},{"isoCode":"lb","phoneCode":"961","phonePattern":"+961-_-___-___"},{"isoCode":"lk","phoneCode":"94","phonePattern":"+94-__-___-____"},{"isoCode":"mm","phoneCode":"95","phonePattern":"+95-___-___"},{"isoCode":"mn","phoneCode":"976","phonePattern":"+976-__-__-____"},{"isoCode":"mv","phoneCode":"960","phonePattern":"+960-___-____"},{"isoCode":"my","phoneCode":"60","phonePattern":"+60-_-___-___"},{"isoCode":"np","phoneCode":"977","phonePattern":"+977-__-___-___"},{"isoCode":"om","phoneCode":"968","phonePattern":"+968-__-___-___"},{"isoCode":"ph","phoneCode":"63","phonePattern":"+63(___)___-____"},{"isoCode":"pk","phoneCode":"92","phonePattern":"+92(___)___-____"},{"isoCode":"ps","phoneCode":"970","phonePattern":"+970-__-___-____"},{"isoCode":"qa","phoneCode":"974","phonePattern":"+974-____-____"},{"isoCode":"sa","phoneCode":"966","phonePattern":"+966-_-___-____"},{"isoCode":"sg","phoneCode":"65","phonePattern":"+65-____-____"},{"isoCode":"sy","phoneCode":"963","phonePattern":"+963-__-____-___"},{"isoCode":"th","phoneCode":"66","phonePattern":"+66-__-___-___"},{"isoCode":"tj","phoneCode":"992","phonePattern":"+992-__-___-____"},{"isoCode":"tl","phoneCode":"670","phonePattern":"+670-___-____"},{"isoCode":"tm","phoneCode":"993","phonePattern":"+993-_-___-____"},{"isoCode":"tr","phoneCode":"90","phonePattern":"+90(___)___-____"},{"isoCode":"tw","phoneCode":"886","phonePattern":"+886-____-____"},{"isoCode":"uz","phoneCode":"998","phonePattern":"+998-__-___-____"},{"isoCode":"vn","phoneCode":"84","phonePattern":"+84-__-____-___"},{"isoCode":"ye","phoneCode":"967","phonePattern":"+967-_-___-___"}]},{"regionCode":"019","region":"north_america","countries":[{"isoCode":"ag","phoneCode":"1268","phonePattern":"+1(268)___-____"},{"isoCode":"bb","phoneCode":"1246","phonePattern":"+1(246)___-____"},{"isoCode":"tt","phoneCode":"1868","phonePattern":"+1(868)___-____"},{"isoCode":"bs","phoneCode":"1242","phonePattern":"+1(242)___-____"},{"isoCode":"bz","phoneCode":"501","phonePattern":"+501-___-____"},{"isoCode":"cr","phoneCode":"506","phonePattern":"+506-____-____"},{"isoCode":"cu","phoneCode":"53","phonePattern":"+53-_-___-____"},{"isoCode":"dm","phoneCode":"1767","phonePattern":"+1(767)___-____"},{"isoCode":"do","phoneCode":"1809","phonePattern":"+1(809)___-____"},{"isoCode":"do","phoneCode":"1829","phonePattern":"+1(829)___-____"},{"isoCode":"do","phoneCode":"1849","phonePattern":"+1(849)___-____"},{"isoCode":"gd","phoneCode":"1473","phonePattern":"+1(473)___-____"},{"isoCode":"gt","phoneCode":"502","phonePattern":"+502-_-___-____"},{"isoCode":"hn","phoneCode":"504","phonePattern":"+504-____-____"},{"isoCode":"ht","phoneCode":"509","phonePattern":"+509-__-__-____"},{"isoCode":"jm","phoneCode":"1876","phonePattern":"+1(876)___-____"},{"isoCode":"kn","phoneCode":"1869","phonePattern":"+1(869)___-____"},{"isoCode":"lc","phoneCode":"1758","phonePattern":"+1(758)___-____"},{"isoCode":"mx","phoneCode":"52","phonePattern":"+52-__-__-____"},{"isoCode":"ni","phoneCode":"505","phonePattern":"+505-____-____"},{"isoCode":"pa","phoneCode":"507","phonePattern":"+507-___-____"},{"isoCode":"sv","phoneCode":"503","phonePattern":"+503-__-__-____"},{"isoCode":"vc","phoneCode":"1784","phonePattern":"+1(784)___-____"},{"isoCode":"us","phoneCode":"1","phonePattern":"+1(___)___-____"},{"isoCode":"ca","phonePattern":"+1(___)___-____"}]},{"regionCode":"419","region":"south_america","countries":[{"isoCode":"ar","phoneCode":"54","phonePattern":"+54(___)___-____"},{"isoCode":"br","phoneCode":"55","phonePattern":"+55-__-____-____"},{"isoCode":"ve","phoneCode":"58","phonePattern":"+58(___)___-____"},{"isoCode":"co","phoneCode":"57","phonePattern":"+57(___)___-____"},{"isoCode":"cl","phoneCode":"56","phonePattern":"+56-_-____-____"},{"isoCode":"py","phoneCode":"595","phonePattern":"+595(___)___-___"},{"isoCode":"sr","phoneCode":"597","phonePattern":"+597-___-___"},{"isoCode":"bo","phoneCode":"591","phonePattern":"+591-_-___-____"},{"isoCode":"ec","phoneCode":"593","phonePattern":"+593-_-___-____"},{"isoCode":"gy","phoneCode":"592","phonePattern":"+592-___-____"},{"isoCode":"pe","phoneCode":"51","phonePattern":"+51(___)___-___"},{"isoCode":"uy","phoneCode":"598","phonePattern":"+598-_-___-__-__"}]},{"regionCode":"002","region":"africa","countries":[{"isoCode":"ao","phoneCode":"244","phonePattern":"+244(___)___-___"},{"isoCode":"bf","phoneCode":"226","phonePattern":"+226-__-__-____"},{"isoCode":"bi","phoneCode":"257","phonePattern":"+257-__-__-____"},{"isoCode":"bj","phoneCode":"229","phonePattern":"+229-__-__-____"},{"isoCode":"bw","phoneCode":"267","phonePattern":"+267-__-___-___"},{"isoCode":"cd","phoneCode":"243","phonePattern":"+243(___)___-___"},{"isoCode":"cf","phoneCode":"236","phonePattern":"+236-__-__-____"},{"isoCode":"cg","phoneCode":"242","phonePattern":"+242-__-___-____"},{"isoCode":"ci","phoneCode":"225","phonePattern":"+225-__-___-___"},{"isoCode":"cm","phoneCode":"237","phonePattern":"+237-____-____"},{"isoCode":"cv","phoneCode":"238","phonePattern":"+238(___)__-__"},{"isoCode":"dj","phoneCode":"253","phonePattern":"+253-__-__-__-__"},{"isoCode":"dz","phoneCode":"213","phonePattern":"+213-__-___-____"},{"isoCode":"eg","phoneCode":"20","phonePattern":"+20(___)___-____"},{"isoCode":"er","phoneCode":"291","phonePattern":"+291-_-___-___"},{"isoCode":"et","phoneCode":"251","phonePattern":"+251-__-___-____"},{"isoCode":"ga","phoneCode":"241","phonePattern":"+241-_-__-__-__"},{"isoCode":"gh","phoneCode":"233","phonePattern":"+233(___)___-___"},{"isoCode":"gm","phoneCode":"220","phonePattern":"+220(___)__-__"},{"isoCode":"gn","phoneCode":"224","phonePattern":"+224-__-___-___"},{"isoCode":"gq","phoneCode":"240","phonePattern":"+240-__-___-____"},{"isoCode":"gw","phoneCode":"245","phonePattern":"+245-_-______"},{"isoCode":"ke","phoneCode":"254","phonePattern":"+254-___-______"},{"isoCode":"km","phoneCode":"269","phonePattern":"+269-__-_____"},{"isoCode":"lr","phoneCode":"231","phonePattern":"+231-__-___-___"},{"isoCode":"ls","phoneCode":"266","phonePattern":"+266-_-___-____"},{"isoCode":"ly","phoneCode":"218","phonePattern":"+218-__-___-___"},{"isoCode":"ma","phoneCode":"212","phonePattern":"+212-__-____-___"},{"isoCode":"mg","phoneCode":"261","phonePattern":"+261-__-__-_____"},{"isoCode":"ml","phoneCode":"223","phonePattern":"+223-__-__-____"},{"isoCode":"mr","phoneCode":"222","phonePattern":"+222-__-__-____"},{"isoCode":"mu","phoneCode":"230","phonePattern":"+230-___-____"},{"isoCode":"mw","phoneCode":"265","phonePattern":"+265-_-____-____"},{"isoCode":"mz","phoneCode":"258","phonePattern":"+258-__-___-___"},{"isoCode":"na","phoneCode":"264","phonePattern":"+264-__-___-____"},{"isoCode":"ne","phoneCode":"227","phonePattern":"+227-__-__-____"},{"isoCode":"ng","phoneCode":"234","phonePattern":"+234-__-___-__"},{"isoCode":"rw","phoneCode":"250","phonePattern":"+250(___)___-___"},{"isoCode":"sc","phoneCode":"248","phonePattern":"+248-_-___-___"},{"isoCode":"sd","phoneCode":"249","phonePattern":"+249-__-___-____"},{"isoCode":"sl","phoneCode":"232","phonePattern":"+232-__-______"},{"isoCode":"sn","phoneCode":"221","phonePattern":"+221-__-___-____"},{"isoCode":"so","phoneCode":"252","phonePattern":"+252-_-___-___"},{"isoCode":"ss","phoneCode":"211","phonePattern":"+211-__-___-____"},{"isoCode":"st","phoneCode":"239","phonePattern":"+239-__-_____"},{"isoCode":"sz","phoneCode":"268","phonePattern":"+268-__-__-____"},{"isoCode":"td","phoneCode":"235","phonePattern":"+235-__-__-__-__"},{"isoCode":"tg","phoneCode":"228","phonePattern":"+228-__-___-___"},{"isoCode":"tn","phoneCode":"216","phonePattern":"+216-__-___-___"},{"isoCode":"tz","phoneCode":"255","phonePattern":"+255-__-___-____"},{"isoCode":"ug","phoneCode":"256","phonePattern":"+256(___)___-___"},{"isoCode":"za","phoneCode":"27","phonePattern":"+27-__-___-____"},{"isoCode":"zm","phoneCode":"260","phonePattern":"+260-__-___-____"},{"isoCode":"zw","phoneCode":"263","phonePattern":"+263-_-______"}]},{"regionCode":"009","region":"oceania","countries":[{"isoCode":"au","phoneCode":"61","phonePattern":"+61-_-____-____"},{"isoCode":"fj","phoneCode":"679","phonePattern":"+679-__-_____"},{"isoCode":"fm","phoneCode":"691","phonePattern":"+691-___-____"},{"isoCode":"ki","phoneCode":"686","phonePattern":"+686-__-___"},{"isoCode":"mh","phoneCode":"692","phonePattern":"+692-___-____"},{"isoCode":"nr","phoneCode":"674","phonePattern":"+674-___-____"},{"isoCode":"nz","phoneCode":"64","phonePattern":"+64-__-___-___"},{"isoCode":"pg","phoneCode":"675","phonePattern":"+675(___)__-___"},{"isoCode":"pw","phoneCode":"680","phonePattern":"+680-___-____"},{"isoCode":"sb","phoneCode":"677","phonePattern":"+677-_____"},{"isoCode":"to","phoneCode":"676","phonePattern":"+676-_____"},{"isoCode":"tv","phoneCode":"688","phonePattern":"+688-_____"},{"isoCode":"vu","phoneCode":"678","phonePattern":"+678-_____"},{"isoCode":"ws","phoneCode":"685","phonePattern":"+685-__-____"}]}],
lang: 'ru-RU',
mc: {"regions":{"europe":"Европа","asia":"Азия","north_america":"Северная Америка","south_america":"Южная Америка","africa":"Африка","oceania":"Океания"},"countries":{"ad":"Андорра","ae":"Арабские Эмираты","af":"Афганистан","ag":"Антигуа и Барбуда","al":"Албания","am":"Армения","ao":"Ангола","ar":"Аргентина","at":"Австрия","au":"Австралия","az":"Азербайджан","ba":"Босния и Герцеговина","bb":"Барбадос","bd":"Бангладеш","be":"Бельгия","bf":"Буркина Фасо","bg":"Болгария","bh":"Бахрейн","bi":"Бурунди","bj":"Бенин","bn":"Бруней-Даруссалам","bo":"Боливия","br":"Бразилия","bs":"Багамские Острова","bt":"Бутан","bw":"Ботсвана","by":"Белоруссия","bz":"Белиз","cd":"Конго (Киншаса)","cf":"Центральноафриканская Республика","cg":"Конго (Браззавиль)","ch":"Швейцария","ci":"Кот-д’Ивуар","cl":"Чили","cm":"Камерун","cn":"Китай","co":"Колумбия","cr":"Коста-Рика","cu":"Куба","cv":"Кабо-Верде","cy":"Кипр","cz":"Чехия","de":"Германия","dj":"Джибути","dk":"Дания","dm":"Доминика","do":"Доминиканская Республика","dz":"Алжир","ec":"Эквадор","ee":"Эстония","eg":"Египет","er":"Эритрея","es":"Испания","et":"Эфиопия","fi":"Финляндия","fj":"Фиджи","fm":"Ф.Ш. Микронезии","fr":"Франция","ga":"Габон","gd":"Гренада","ge":"Грузия","gh":"Гана","gm":"Гамбия","gn":"Гвинея","gq":"Экваториальная Гвинея","gr":"Греция","gt":"Гватемала","gw":"Гвинея-Бисау","gy":"Гайана","hn":"Гондурас","hr":"Хорватия","ht":"Гаити","hu":"Венгрия","id":"Индонезия","ie":"Ирландия","il":"Израиль","in":"Индия","iq":"Ирак","ir":"Иран","is":"Исландия","it":"Италия","jm":"Ямайка","jo":"Иордания","jp":"Япония","ke":"Кения","kg":"Киргизия","kh":"Камбоджа","ki":"Кирибати","km":"Коморы","kn":"Сент-Китс и Невис","kp":"Корейская НДР","kr":"Респ. Корея","kw":"Кувейт","kz":"Казахстан","la":"Лаос","lb":"Ливан","lc":"Сент-Люсия","li":"Лихтенштейн","lk":"Шри-Ланка","lr":"Либерия","ls":"Лесото","lt":"Литва","lu":"Люксембург","lv":"Латвия","ly":"Ливия","ma":"Марокко","mc":"Монако","md":"Молдова","me":"Черногория","mg":"Мадагаскар","mh":"Маршалловы Острова","mk":"Респ. Македония","ml":"Мали","mm":"Бирма (Мьянма)","mn":"Монголия","mr":"Мавритания","mt":"Мальта","mu":"Маврикий","mv":"Мальдивские острова","mw":"Малави","mx":"Мексика","my":"Малайзия","mz":"Мозамбик","na":"Намибия","ne":"Нигер","ng":"Нигерия","ni":"Никарагуа","nl":"Нидерланды","no":"Норвегия","np":"Непал","nr":"Науру","nz":"Новая Зеландия","om":"Оман","pa":"Панама","pe":"Перу","pg":"Папуа-Новая Гвинея","ph":"Филиппины","pk":"Пакистан","pl":"Польша","ps":"Палестина","pt":"Португалия","pw":"Палау","py":"Парагвай","qa":"Катар","ro":"Румыния","rs":"Сербия","ru":"Россия","rw":"Руанда","sa":"Саудовская Аравия","sb":"Соломоновы Острова","sc":"Сейшелы","sd":"Судан","se":"Швеция","sg":"Сингапур","si":"Словения","sk":"Словакия","sl":"Сьерра-Леоне","sm":"Сан-Марино","sn":"Сенегал","so":"Сомали","sr":"Суринам","ss":"Южный Судан","st":"Сан-Томе и Принсипи","sv":"Сальвадор","sy":"Сирийская арабская республика","sz":"Свазиленд","td":"Чад","tg":"Того","th":"Таиланд","tj":"Таджикистан","tl":"Восточный Тимор","tm":"Туркменистан","tn":"Тунис","to":"Тонга","tr":"Турция","tt":"Тринидад и Тобаго","tv":"Тувалу","tw":"Тайвань","tz":"Танзания","ua":"Украина","ug":"Уганда","gb":"Великобритания","uy":"Уругвай","uz":"Узбекистан","va":"Ватикан","vc":"Сент-Винсент и Гренадины","ve":"Венесуэла","vn":"Вьетнам","vu":"Вануату","ws":"Самоа","ye":"Йемен","za":"Южно-Африканская Респ.","zm":"Замбия","zw":"Зимбабве","us":"Соединенные Штаты","ca":"Канада"},"widget":{"internalError":"Внутренняя ошибка. Попробуйте позже","incorrectWebsite":"Звонок запрошен с неверного сайта.","callbackIsPlaned":"Звонок на ваш номер уже</br>запланирован.","callbackIsAlready":"На данный номер уже осуществляется звонок.","tooManyRequestNumber":"Слишком много звонков</br>с вашего номера. Попробуйте</br>повторить позже.","tooManyRequestIp":"Слишком много звонков</br>с вашего IP адреса. Попробуйте</br>повторить позже","countryDisabled":"К сожалению, мы не можем позвонить в эту страну.","acceptRequest":"Ваша заявка принята </br> Спасибо за обращение в нашу компанию!</br> Мы скоро свяжемся с вами.","thankYouWorkingTime":"Спасибо за обращение в нашу компанию!</br> Мы свяжемся с вами в рабочее время.","thankYou":"Спасибо за обращение</br> в нашу компанию!","workdayEnd":"К сожалению, мы уже</br> не работаем. ","requestCallback":"Оставить заявку <br> на обратный звонок","callbackTime":"Перезвоним бесплатно</br>за&nbsp;{time}&nbsp;секунд","callbackNotWorkingTime":"Менеджер свяжется с вами в {time}","callingProcess":"Мы уже звоним вам!","callMe":"ЖДУ ЗВОНКА","widget":"Виджет"},"widget_v2":{"incorrectWebsite":"Звонок запрошен с неверного сайта.","callbackIsPlaned":"Звонок на ваш номер уже запланирован.","callbackIsAlready":"На данный номер уже осуществляется звонок.","tooManyRequestNumber":"Слишком много звонков с вашего номера.</br>Попробуйте повторить позже.","tooManyRequestIp":"Слишком много звонков с вашего IP</br>адреса. Попробуйте повторить позже.","countryDisabled":"К сожалению, мы не можем позвонить в эту страну.","acceptRequest":"Ваша заявка принята </br> Спасибо за обращение в нашу компанию! </br> Мы скоро свяжемся с вами.","thankYouWorkingTime":"Спасибо за обращение в нашу компанию!</br> Мы свяжемся с вами в рабочее время.","thankYou":"Спасибо за обращение</br> в нашу компанию!","workdayEnd":"К сожалению, мы уже не работаем. ","requestCallback":"Оставить заявку <br> на обратный звонок","callbackTime":"Перезвоним бесплатно <br><b style=\"white-space:nowrap\"> за&nbsp;{time}&nbsp;секунд</b>","callbackNotWorkingTime":"</br>Менеджер свяжется с вами в {time}"},"widget_v3":{"incorrectWebsite":"Звонок запрошен с неверного сайта.","callbackIsPlaned":"Звонок на ваш номер уже</br>запланирован.","callbackIsAlready":"На данный номер уже осуществляется звонок.","tooManyRequestNumber":"Слишком много звонков</br>с вашего номера. Попробуйте</br>повторить позже.","tooManyRequestIp":"Слишком много звонков</br>с вашего IP адреса. Попробуйте</br>повторить позже","countryDisabled":"К сожалению, мы не можем позвонить в эту страну.","acceptRequest":"Ваша заявка принята </br> Спасибо за обращение в нашу компанию!</br> Мы скоро свяжемся с вами.","thankYouWorkingTime":"Спасибо за обращение в нашу компанию!</br> Мы свяжемся с вами в рабочее время.","thankYou":"Спасибо за обращение</br>в нашу компанию!","workdayEnd":"К сожалению, мы уже</br> не работаем. ","requestCallback":"Оставить заявку <br> на обратный звонок","callbackTime":"Перезвоним бесплатно","callbackNotWorkingTime":"</br>Менеджер свяжется с вами</br>в {time}"}},
wsProtocol: 'wss://'
    };

    var mcData = cfg.mc || {},
        calldirections = [],
        countriesList = cfg.countriesList || [],
        countryNames = mcData.countries || {countries: {}};

    if (cfg.calldirection) {
        calldirections = JSON.parse(cfg.calldirection.toLowerCase());
    }

    // удаляем группировку стран по континентам
    countriesList = countriesList.reduce(function (acc, x) {
        return acc.concat(x.countries);
    }, []);

    var _conn, metrika;

    var $selectedCountryWrapper = null,
        $selectedCountry = null,
        $list = null,
        selectedCountryCode = cfg.selectedCountryCode,
        sortedCountries = [],
        currentCountryDisabled = false,
        phonePatternAdditional = null,
        phonePatternNoAdditional = cfg.phonePattern;

    var mc = function(path, params) {
        if (path.includes("widget_v") && !getMcData(path)) {
            path = path.replace(/widget_v(\d)./g, "widget.");
        }
        var mcData = getMcData(path);
        if (params && mcData) {
            return mcData.replace("{"+Object.keys(params)+"}", Object.values(params));
        } else {
            return mcData;
        }
    }

    var getMcData = function(path) {
        var value = mcData,
            keysArr = path.split(".");

        for (const key of keysArr) {
            if (value[key]) {
                value = value[key];
            } else {
                value = undefined;
                break;
            }
        }

        return value;
    };

    var APIConnection = function(url, hello) {
        var conn, seq = 0, ack = 0, lastSentAck = 0, sid, reqSeq = 0, reqCallbacks = {};

        var self = this;

        var unackedMessages;

        function sendMessage(m) {
            if (conn) {
                var s = JSON.stringify(m);
                if (self.debugOut) {
                    self.debugOut(m);
                }
                conn.send(s);
            }
        }
        function onOpen(event) {
            var h;
            if (sid) {
                h = {
                    sid: sid,
                    ack: ack
                };
                if (unackedMessages && unackedMessages.length > 0) {
                    h.seq = unackedMessages[0].seq;
                    var payloads = [];
                    for (var i = 0; i < unackedMessages.length; i++) {
                        payloads.push(unackedMessages[i].payload);
                    }
                    h.payloads = payloads;
                }
            } else {
                h = hello;
            }
            sendMessage(h);
        }
        function onClose(event) {
            if (sid && self.ondisconnect) {
                self.ondisconnect();
            }
            conn = undefined;
        }
        function onError(event) {
            if (self.onError) {
                self.onError(event);
            }
        }
        function receivePayload(d) {
            removeAcked(d.ack);
            if (d.payloads) {
                var curSeq = d.seq;
                for (var i = 0; i < d.payloads.length; i++) {
                    if (curSeq > ack) {
                        processPayload(d.payloads[i]);
                        ack = curSeq;
                        curSeq++;
                    }
                }
            } else {
                if (d.seq > ack) {
                    if (d.payload) {
                        processPayload(d.payload);
                    }
                    ack = d.seq;
                }
            }
            if (ack - lastSentAck > 4) {
                sendMessage({ack: ack});
                lastSentAck = ack;
            }

        }
        function processPayload(p) {
            if (!p) return;
            switch(p.What) {
            case "request":
                if (self.onrequest) {
                    var resp = self.onrequest(p[""]);
                    self.send({What: "response", id: p.id, "": resp});
                }
                break;
            case "response":
                if (p.id != null) {
                    var cb = reqCallbacks[p.id];
                    if (cb) {
                        cb(p[""]);
                        delete reqCallbacks[p.id];
                    }
                }
                break;
            default:
                if (self.onMessage) {
                    self.onMessage(p);
                }
                break;
            }
        }
        function handleMessage(event) {
            if (self.debugIn) {
                self.debugIn(event.data);
            }
            var d = JSON.parse(event.data);
            if (d.bye) {
                sid = undefined;
                ack = 0;
                seq = 0;
                lastSentAck = 0;
                unackedMessages = undefined;
                if (self.onClose) {
                    self.onClose();
                }
            } else {
                receivePayload(d)
            }
        }
        function handleHelloResponse(event) {
            if (self.debugIn) {
                self.debugIn(event.data);
            }
            var d = JSON.parse(event.data);
            if (d.status === "ok") {
                if (self.onConnected) {
                    self.onConnected();
                }
                if (d.sid) {
                    sid = d.sid;
                } else {
                    receivePayload(d);
                }
                conn.onmessage = handleMessage;
            } else if (d.status === "error" && d.error === "Invalid session") {
                sid = null;
                if (hello && hello.sid) {
                    delete hello.sid;
                }
                setTimeout(self.connect, 200)
            }
        }
        function removeAcked(ack) {
            if (unackedMessages && unackedMessages.length > 0) {
                if (unackedMessages[unackedMessages.length - 1].seq <= ack) {
                    unackedMessages = undefined;
                } else {
                    while (unackedMessages.length > 0 && unackedMessages[0].seq <= ack) {
                        unackedMessages.shift();
                    }
                }
            }
        }
        self.connect = function() {
            try {
                if (!conn) {
                    conn = new WebSocket(url);
                    conn.onopen = onOpen;
                    conn.onmessage = handleHelloResponse;
                    conn.onclose = onClose;
                    conn.onerror = onError;
                }
            } catch (e) {
                onError(e)
            }
        };
        self.send = function(payload) {
            seq++;
            var m = {
                seq: seq,
                ack: ack,
                payload: payload
            };
            lastSentAck = ack;
            if (unackedMessages) {
                unackedMessages.push(m);
            } else {
                unackedMessages = [ m ];
            }
            sendMessage(m);
        };
        self.sendRequest = function(request, callback) {
            if (typeof(callback) === "function") {
                var reqId = reqSeq++;
                var payload = {What: "request", id: reqId, "": request};
                reqCallbacks[reqId] = callback;
                self.send(payload);
            } else {
                self.send(request);
            }
        };
        self.disconnect = function() {
            conn.close();
            conn = undefined;
        }
    };

    var icaret = {
        caret : function(input, begin, end) {
            if (typeof begin === 'number') {
                end = (typeof end === 'number') ? end : begin;

                if (input.setSelectionRange) {
                    input.setSelectionRange(begin, end)
                } else if (input.createTextRange) {
                    var range = input.createTextRange()
                    range.collapse(true);
                    range.moveEnd('character', end);
                    range.moveStart('character', begin);
                    range.select();
                }
                return
            }

            if (input.setSelectionRange) {
                begin = input.selectionStart;
                end = input.selectionEnd;
            } else if (d.selection && d.selection.createRange) {
                var range = d.selection.createRange();
                begin = 0 - range.duplicate().moveStart('character', -100000);
                end = begin + range.text.length;
            }
            return  { begin: begin, end: end }
        },


        shiftR : function(pos) {
            var i, c, j, t

            c = this.getPlaceHolder(pos)
            for (i = pos; i < this.len; i++) {
                if (!this.tests[i])
                    continue

                j = this.seekNext(i)
                t = this.buffer[i]

                this.buffer[i] = c
                if (j < this.len && this.tests[j].test(t)) {
                    c = t
                } else {
                    break
                }
            }
        },

        clearBuffer : function(start, end) {
            var i

            if (!start || !end) {
                this.buffer = []
            } else {
                for (i = start; i < end && i < this.len; i++) {
                    if (!this.tests[i])
                        continue

                    this.buffer[i] = Number(this.getPlaceHolder(i)) >= 0 ? '' : this.getPlaceHolder(i)
                }
            }
        },

        shiftL : function(begin, end) {
            var i, j

            if (begin < 0)
                return

            j = this.seekNext(end)
            for (i = begin; i < this.len; i++) {
                if (!this.tests[i])
                    continue

                if (j < this.len && this.tests[i].test(this.buffer[j])) {
                    this.buffer[i] = this.buffer[j]
                    this.buffer[j] = Number(this.getPlaceHolder(j)) ? '' : this.getPlaceHolder(j)
                } else {
                    break
                }

                j = this.seekNext(j)
            }

            this.writeBuffer()
        },

        initBuffer : function() {
            this.len = this.placeHolder.length
            this.rx = new RegExp('[0-9]')
            this.tests = []

            var dgts = this.placeHolder.split('')
            for (var x in dgts)  {
                if (dgts[x] == '_' || Number(dgts[x]) >= 0) {
                    this.tests.push(new RegExp('[0-9]'))
                    if (this.firstNonMaskPos === null)
                        this.firstNonMaskPos = x
                } else {
                    this.tests.push(null)
                }

                this.buffer[x] = this.getPlaceHolder(x)
            }
        },

        seekNext : function(pos) {
            while (++pos < this.len && !this.tests[pos]);
            return pos;
        },

        seekPrev : function(pos) {
            while (--pos >= 0 && !this.tests[pos]);
            return pos;
        },

        getPlaceHolder : function(i) {
            if (i < this.placeHolder.length)
                return this.placeHolder.charAt(i)

            return this.placeHolder.charAt(0)
        },

        checkVal : function(input, allow) {
            var test = input.value
            var lastMatch = -1
            var i, c, pos

            for (i = 0, pos = 0; i < this.len; i++) {
                if (this.tests[i]) {
                    this.buffer[i] = this.getPlaceHolder(i)
                    while (pos++ < test.length) {
                        c = test.charAt(pos - 1)
                        if (this.tests[i].test(c)) {
                            this.buffer[i] = c
                            lastMatch = i
                            break
                        }
                    }

                    if (pos > test.length) {
                        this.clearBuffer(i + 1, this.len)
                        break
                    }
                } else {
                    if (this.buffer[i] === test.charAt(pos))
                        pos++

                    if (i < this.len)
                        lastMatch = i
                }
            }

            if (allow) {
                this.writeBuffer()
            } else if (lastMatch + 1 < this.len) {
                if (input.value)
                    input.value = ''

                this.clearBuffer(0, this.len)
            } else {
                this.writeBuffer()
                input.value = input.value.substring(0, lastMatch + 1)
            }

            return i
        },

        buffer : [],

        writeBuffer : function() {
            var inp = f.getElement('itlcb-input');
            currentCountryDisabled = $selectedCountry.classList.contains('disabled');

            inp.value = this.buffer.join('');

            if (this.isValidValue(inp) && !currentCountryDisabled)
                f.enableCallButton();
            else
                f.disableCallButton();
        },

        isValidValue: function(input) {
            var rex;

            rex = cfg.phonePattern.replace(/_/g, '\\d');
            rex = rex.replace('(', '\\(');
            rex = rex.replace(')', '\\)');
            rex = rex.replace('+', '\\+');
            rex = new RegExp('^' + rex + '$');

            return rex.test(input.value);
        },

        placeHolder: cfg.phonePattern,
        firstNonMaskPos: null,
        len : -1,
        oldVal : ''
    };

    var Metrika = function() {
        var yandex = (function() {
            var array = [], counters;
            if (typeof ym === 'function') {
                for (var i in ym.a) {
                    counters = ym.a[i];
                    if (counters[1] === 'init') {
                        array.push(counters[0]);
                    }
                }
                return function(name) {
                    for (var i in array)
                        ym(array[i], 'reachGoal', String(name));
                };
            }
            return;
        })();
        var google = (function() {
            var category = 'Callback';
            if (typeof gtag === 'function') {
                return function(name) {
                    gtag('event', String(name), {'event_category': category});
                };
            } else if (typeof ga === 'function') {
                return function(name) {
                    ga('send', 'event', category, String(name));
                };
            }
            return;
        })();

        this.addGoal = function(name) {
            if (typeof yandex === 'function') {
                yandex(name);
            }
            if (typeof google === 'function') {
                google(name);
            }
        };
    };

    var f = {

        ua : '',

        isAndroid : false,
        isChrome : false,

        callTimer: null,

        timeSpent : 0,
        pagesViewed : 0,

        left: false,
        step: 1,
        typeAnimation: null,

        appendStyle : function() {
            /*  https://kb.itoolabs.com/pages/viewpage.action?pageId=65177102  */
            var style = document.createElement("style");
            style.type = "text/css";
            style.innerHTML = "" +
                "@font-face {\n" +
                "  font-family: 'cb-icons';\n" +
                "  src: url('" + cfg.mediaPath + "/cb-icons.ttf') format('truetype');\n" +
                "}";
            document.getElementsByTagName("head")[0].appendChild(style);

            var countryList = d.createElement('link');
            countryList.type = 'text/css';
            countryList.rel = 'stylesheet';
            countryList.media = 'all';
            countryList.href = cfg.mediaPath + '/media/callback/css/country-selectbox.css';
            d.body.insertBefore(countryList, d.body.lastChild);

            var e = d.createElement('link');
            e.type = 'text/css';
            e.rel = 'stylesheet';
            e.media = 'all';
            e.href = cfg.mediaPath + '/media/callback/css/widget' + cfg.widgetcode + '.css';
            d.body.insertBefore(e, d.body.lastChild);
        },

        getElement : function(id) {
            return d.getElementById(id)
        },

        removeClass: function(mobj, classes) {
            var i;
            var cArray = classes.split(/[\s]+/);

            for (i = 0; i < cArray.length; i ++) {
                if (mobj.classList) {
                    mobj.classList.remove(cArray[i]);
                } else {
                    var rx = new RegExp('(^|\\b)' + cArray[i].split(' ').join('|') + '(\\b|$)', 'gi');
                    mobj.className = mobj.className.replace(rx, ' ');
                }
            }
        },

        addClass: function(mobj, classes) {
            var i;
            var cArray = classes.split(/[\s]+/);

            for (i = 0; i < cArray.length; i++) {
                if (f.hasClass(mobj, cArray[i]))
                    continue;

                if (mobj.classList) {
                    mobj.classList.add(cArray[i]);
                } else {
                    mobj.className += ' ' + cArray[i];
                }
            }

        },

        hasClass: function(mobj, className) {
            if (mobj.classList)
                return mobj.classList.contains(className)

            var rx = new RegExp('(^| )' + className + '( |$)', 'gi');

            return rx.test(mobj.className)
        },

        on: function(el, myevent, func) {
            if (el.addEventListener) {
                el.addEventListener(myevent, func);
            } else {
                el.attachEvent('on' + myevent, func);
            }
        },

        trigger: function(el, myevent, evobj, data) {
            var c, e;

            if (d.dispatchEvent) {
                switch (myevent) {
                case 'click':
                case 'mousedown':
                case 'mouseup':
                    e = 'MouseEvents';
                    break;
                case 'keyup':
                    e = 'KeyboardEvent';
                    break;
                case 'focus':
                case 'change':
                case 'blur':
                case 'select':
                default:
                    e = 'HTMLEvents';
                }

                if (!evobj) {
                    c = d.createEvent(e);

                    c.initEvent(myevent, myevent != 'change', true);
                    c.synthetic = true;
                    c.view = window;
                    c.altKey = false;
                    c.ctrlKey = false;
                    c.shiftKey = false;
                    c.metaKey = false;
                    c.keyCode = data.charCodeAt(0)
                } else
                    c = evobj;

                el.dispatchEvent(c, true, true);
            }
        },

        getOptionForAnimation: function(settings) {
            var option = "", side = "";
            if (settings && settings.positionButton && settings.positionWidget) {
                side = settings.positionButton.match(/(right|left)/)[0];
                settings = String(settings.positionWidget) + "-" + side;
            }

            if (settings === "1-left" || settings === "1-right") {
                option = "bottom";
            } else if (settings === "2") {
                option = "opacity";
            } else if (settings === "3-right") {
                option = "right";
            } else if (settings === "3-left") {
                option = "left";
            }

            return option;
        },

        hide: function(elemId) {
            var el = this.getElement(elemId);

            var animation = function(settings) {
                var option = f.getOptionForAnimation(settings);

                el.style.transition = "all 100ms linear";
                if (option === "opacity") {
                    el.style.opacity = 0;
                    el.style.visibility = "hidden";
                } else if (option === "right") {
                    el.style.right = "-" + el.offsetWidth + "px";
                    el.style.visibility = "hidden";
                } else if (option === "left") {
                    el.style.left = "-" + el.offsetWidth + "px";
                    el.style.visibility = "hidden";
                } else if (option === "bottom") {
                    el.style.bottom = "-" + el.offsetHeight + "px";
                    el.style.visibility = "hidden";
                } else {
                    el.style.transition = "";
                    el.style.visibility = "hidden";
                }
            };
            animation();
            return { animation: animation };
        },
        show: function(elemId) {
            var el = this.getElement(elemId);
            el.style.visibility = "visible";

            var animation = function(settings) {
                var option = f.getOptionForAnimation(settings);

                el.style.transition = "all 100ms linear";
                if (option === "opacity") {
                    el.style.opacity = 1;
                } else if (option === "right") {
                    el.style.right = "0px";
                } else if (option === "left") {
                    el.style.left = "0px";
                } else if (option === "bottom") {
                    el.style.bottom = "20px";
                }
            };
            return { animation: animation };
        },

        trim: function(val) {
            return val.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g, 'qqq')
        },

        setCookie: function(name, value, seconds) {
            var expires = '';
            if (seconds) {
                var date = new Date();
                date.setTime(date.getTime() + (seconds * 1000));
                expires = '; expires=' + date.toUTCString();
            }

            document.cookie = name + '=' + (value || '')  + expires + '; path=/';
        },

        getCookie: function(name) {
            var nameEQ = name + '=';
            var ca = document.cookie.split(';');

            for (var i=0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0)==' ')
                    c = c.substring(1, c.length);

                if (c.indexOf(nameEQ) == 0)
                    return c.substring(nameEQ.length, c.length);
            }

            return null;
        },

        setPositionCallback: function(position) {
            var elStyle = this.getElement('itlcb-call-btn').style;
            switch (position) {
            case "bottom-right":
                elStyle.cssText = 'right: 0px; bottom: 0px;';
                break;
            case "bottom-left":
                elStyle.cssText = 'left: 0px; bottom: 0px;';
                break;
            case "top-right":
                elStyle.cssText = 'right: 0px; top: 0px;';
                break;
            case "top-left":
                elStyle.cssText = 'left: 0px; top: 0px;';
                break;
            default:
                elStyle.cssText = 'right: 0px; bottom: 0px;';
            }
        },
        setColors: function() {
            var colors = JSON.parse(cfg.colors) || {};
            var $btn = this.getElement("itlcb-call-btn");
            var $btnCall = this.getElement("itlcb-do-call");
            this.addClass($btnCall, cfg.lang);
            var $popup = document.querySelectorAll(".itlcb-widget-body, .itlcb-call-info-block, .itlcb-close-cross");
            var $text = document.querySelectorAll(".itlcb-widget-body *:not(.itlcb-phone-input), .itlcb-call-info-block *");
            var shadeColor2 = function(color, percent) {
                var f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=f>>8&0x00FF,B=f&0x0000FF;
                return "#"+(0x1000000+(Math.round((t-R)*p)+R)*0x10000+(Math.round((t-G)*p)+G)*0x100+(Math.round((t-B)*p)+B)).toString(16).slice(1);
            };

            var style = document.createElement("style"),
                iconCloseStyle = parseInt(cfg.widgetcode) === 1 ? "background-color" : "color";
            style.type = "text/css";

            style.innerHTML =
                "#itlcb-wrapper.itlcb-opened .itlcb-call-btn.background-callback  { background-color: " + colors.button + "; } \n" +
                "#itlcb-wrapper.itlcb-opened .itlcb-form-call-btn.itlcb-btn-disabled.background-callback  { background-color: " + shadeColor2(colors.button, -0.1) + "; box-shadow: 0 2px 0 0 " + shadeColor2(colors.button, -0.3) + ";} \n" +
                "#itlcb-wrapper.itlcb-opened .itlcb-form-call-btn.background-callback { background-color: " + colors.button + "; box-shadow: 0 2px 0 0 " + shadeColor2(colors.button, -0.3) + "; } \n" +
                "#itlcb-wrapper.itlcb-opened #itlcb-do-call.background-callback:not(.itlcb-btn-disabled):hover { box-shadow: 0 2px 0 0 " + shadeColor2(colors.button, -0.3) + "; } \n" +
                "#itlcb-wrapper.itlcb-opened #itlcb-do-call.background-callback:not(.itlcb-btn-disabled):active { background-color: " + colors.button + "; box-shadow: 0 -2px 0 0 " + shadeColor2(colors.button, -0.3) + "; } \n" +
                "#itlcb-wrapper.itlcb-opened .itlcb-close-cross:hover  { " + iconCloseStyle + ": " + colors.button + "!important; } \n";


            document.getElementsByTagName("head")[0].appendChild(style);

            if (colors.button) {
                this.addClass($btn, "background-callback");
                this.addClass($btnCall, "background-callback");
            }
            if (colors.popup && colors.text) {
                for (var i = 0; i < $popup.length; i++) {
                    $popup[i].style.backgroundColor = colors.popup;
                }
                for (var i = 0; i < $text.length; i++) {
                    $text[i].style.color = colors.text;
                }
            }
        },
        setPositionWidget: function(positionButton) {
            var elStep2 = this.getElement('itlcb-step2'),
                elStep3 = this.getElement('itlcb-step3'),
                elStep4 = this.getElement('itlcb-step4'),
                side = positionButton.match(/(right|left)/)[0] || "right";
            if (side === "left") {
                this.addClass(elStep2, "left");
                this.addClass(elStep3, "left");
                this.addClass(elStep4, "left");
            }
        },
        initWidget : function() {
            if (!cfg.enabled) return;
            this.ua = navigator.userAgent;
            this.isAndroid = /android/i.test(this.ua);
            this.isChrome = /chrome/i.test(this.ua);
            this.isSafari = /safari/i.test(this.ua);
            this.isMobile = /mobile/i.test(this.ua);
            this.left = false;
            this.typeAnimation = { positionButton: cfg.callbutton, positionWidget: cfg.widgetcode };

            metrika = new Metrika();

            const formatPhone = function(phone) {
                return phone.replace(/\D/g, "");
            };

            const changePhonePatternCountry = function(pattern) {
                icaret.placeHolder = pattern;
                cfg.phonePattern = pattern;
                icaret.clearBuffer();
                icaret.initBuffer();
                let i = formatPhone(pattern).length;
                const formattedInputValue = formatPhone(input.value);
                icaret.buffer = pattern.replace(/_/g, () => formattedInputValue[i++] || "_").split("");
                icaret.writeBuffer();
                return icaret.buffer.findIndex(item => item === "_");
            };

            var handleChangeRegion = function (e) {
                changeCountry(e.currentTarget.dataset)
                f.removeClass($list, 'active');
            };

            var changeCountry = function (country) {
                const formattedInputValue = formatPhone(input.value);
                const validPattern = !formattedInputValue.indexOf(formatPhone(cfg.phonePattern));

                if (!country && !validPattern) {
                    if (phonePatternAdditional
                        && phonePatternAdditional === cfg.phonePattern
                        && !formattedInputValue.indexOf(formatPhone(phonePatternNoAdditional))
                    ) {
                        return changePhonePatternCountry(phonePatternNoAdditional);
                    }

                    if (selectedCountryCode) {
                        f.removeClass($selectedCountry, selectedCountryCode);
                    }
                    f.removeClass($selectedCountry, 'disabled');
                    f.removeClass($selectedCountry.parentElement, 'disabled');

                    f.addClass($selectedCountry, 'not-found');
                    f.addClass($selectedCountry.parentElement, 'not-found');
                    $selectedCountry.parentElement.removeAttribute('data-before');
                } else if (!country) {
                    if (phonePatternAdditional && phonePatternAdditional !== cfg.phonePattern) {
                        const formattedPhonePatternAdditional = formatPhone(phonePatternAdditional);
                        if (formattedInputValue.indexOf(formattedPhonePatternAdditional)) return;
                        return changePhonePatternCountry(phonePatternAdditional);
                    }
                } else if (country.phonePattern) {
                    icaret.placeHolder = country.phonePattern;
                    cfg.phonePattern = country.phonePattern;
                    if (country.additional) phonePatternAdditional = country.additional;
                    phonePatternNoAdditional = country.phonePattern;
                    icaret.clearBuffer();
                    icaret.initBuffer();
                    icaret.writeBuffer();

                    if ($selectedCountry.classList.contains('not-found')) {
                        f.removeClass($selectedCountry.parentElement, 'not-found');
                        f.removeClass($selectedCountry, 'not-found');
                    }

                    if (selectedCountryCode) {
                        // если раннее уже была выбрана страна, делаем ее неактивной
                        setCountryListElementStatus(selectedCountryCode, true);
                        f.removeClass($selectedCountry, selectedCountryCode);
                    }

                    selectedCountryCode = country.isoCode;
                    f.addClass($selectedCountry, selectedCountryCode);
                    if (country.disabled) {
                        f.addClass($selectedCountry, 'disabled');
                        f.addClass($selectedCountry.parentElement, 'disabled');
                        $selectedCountry.parentElement.setAttribute('data-before', mc("widget.countryDisabled"));
                    } else {
                        f.removeClass($selectedCountry, 'disabled');
                        f.removeClass($selectedCountry.parentElement, 'disabled');
                        $selectedCountry.parentElement.setAttribute('data-before', countryNames[country.isoCode]);
                        fillListDirections(countriesList, true);
                        setCountryListElementStatus(country.isoCode);
                    }
                }
            }

            var findFirstCountry = function (inputValue) {
                var searchRegExp = /_/g;
                var countryCode = inputValue.split(' ')[0];
                countryCode = countryCode.replace(searchRegExp, "");

                if (countryCode.length < 1) return false;

                var resultList = countriesList.filter(function (item) {
                    return item.phoneCode === formatPhone(inputValue);
                }).sort(function (a,b) { return a.phoneCode.length - b.phoneCode.length });

                return resultList[0] ? resultList[0] : false;
            }

            var fillListDirections = function (redraw) {
                var listAcc = [];
                sortedCountries = countriesList.sort(function ( a, b ) {
                    if (countryNames[a.isoCode]) {
                        return countryNames[a.isoCode].localeCompare(countryNames[b.isoCode]);
                    }
                    return 0;
                });
                if (redraw) {
                    while ($list.firstChild) {
                        $list.removeChild($list.firstChild)
                    }
                }
                sortedCountries.forEach(function (item, i) {
                    var isCountryNotAvailable = !calldirections.filter(function (isoCode) {
                        return item.isoCode === isoCode;
                    }).length;

                    if (isCountryNotAvailable) {
                        sortedCountries[i].disabled = true;
                        return;
                    }

                    var foundedDuplicates = !!listAcc.filter(function (accItem) {
                        // не отрисовываем дубли стран с одинаковыми кодами, но разными масками
                        return accItem.isoCode === item.isoCode
                    }).length;
                    if (foundedDuplicates) return;

                    var li = d.createElement('li'),
                        icon = d.createElement('i'),
                        name = d.createElement('span');

                    name.innerHTML = countryNames[item.isoCode];

                    f.addClass(li, "itlcb-list-element");
                    f.addClass(icon, "itlcb-flag " + item.isoCode);
                    f.addClass(name, "itlcb-name");

                    li.setAttribute('data-iso-code', item.isoCode);
                    li.setAttribute('data-phone-pattern', item.phonePattern);
                    if (item.additional) {
                        li.setAttribute("data-additional", item.additional);
                    }
                    li.appendChild(icon);
                    li.appendChild(name);
                    this.on(li, 'click', handleChangeRegion);
                    $list.appendChild(li);

                    listAcc.push(item);
                }.bind(this));

                $selectedCountry.parentElement.setAttribute('data-before', countryNames[selectedCountryCode]);
                setCountryListElementStatus(selectedCountryCode);
            }.bind(this);

            var setCountryListElementStatus = function(selectedCountryCode, remove) {
                var $listElement = $list.querySelector('.itlcb-list-element[data-iso-code="'+ selectedCountryCode + '"]');
                if (!$listElement) return;

                if (remove) {
                    f.removeClass($listElement, 'active');
                } else {
                    $list.insertAdjacentElement('afterbegin', $listElement);
                    // скролл к выбранному верхнему элементу
                    $list.scrollTo(0, 0);
                    f.addClass($listElement, 'active');
                }
            }

            var staleDiv = this.getElement('itlcb-wrapper');
            if (staleDiv != null)
                d.body.removeChild(staleDiv);

            var div = d.createElement('div');

            div.setAttribute('id', 'itlcb-wrapper');
            this.addClass(div, 'itlcb-opened');

            div.insertAdjacentHTML('beforeend', cfg.html);
            d.body.appendChild(div);

            this.setPositionCallback(cfg.callbutton);
            this.setPositionWidget(cfg.callbutton);

            $selectedCountryWrapper = this.getElement('itlcb-flag-selected-wrapper');
            $selectedCountry = this.getElement('itlcb-flag-selected');
            $list = this.getElement('itlcb-flags-list');

            this.setColors();
            this.on(this.getElement('itlcb-call-btn'), 'click', function (e) {
                f.showStep(2);
                input.focus();
                metrika.addGoal("ITL_CALLBACK_OPEN");
            });
            this.on(this.getElement('itlcb-input'), 'click', function () {
                metrika.addGoal("ITL_CALLBACK_FILL");
            });

            var closeBtnClick = function () {
                if (f.callTimer) f.callTimer.stop();
                f.showStep(1);
                metrika.addGoal("ITL_CALLBACK_CLOSE");
            };

            f.addClass(this.getElement('itlcb-flag-selected'), selectedCountryCode);

            this.on(this.getElement('itlcb-close-btn'), 'click', function() {closeBtnClick()});
            this.on(this.getElement('itlcb-close-btn2'), 'click', function() {closeBtnClick()});
            this.on(this.getElement('itlcb-close-btn3'), 'click', function() {closeBtnClick()});
            this.on(this.getElement('itlcb-bg-fill'), 'click', function (e) {closeBtnClick()});

            var input = this.getElement('itlcb-input');
            icaret.initBuffer();

            this.on(this.getElement('itlcb-do-call'), 'click', function (e) {
                if (!icaret.isValidValue(input)) return;
                if (currentCountryDisabled) return;
                metrika.addGoal("ITL_CALLBACK_CALL");
                f.initCall();
            });

            this.on($selectedCountryWrapper, 'click', function () {
                if ($list.classList.contains('active')) {
                    f.removeClass($list, 'active');
                } else {
                    f.addClass($list, 'active');
                    $list.focus();
                }
            });

            this.on($list, 'blur', function () {
                if ($list.classList.contains('active')) {
                    setTimeout(function () {
                        f.removeClass($list, 'active');
                    }, 200)
                }
            });

            this.showStep(1);

            // заполняем и отрисовываем список стран в дропдауне после отрисовки самого виджета
            fillListDirections(countriesList);
            const country = sortedCountries.filter(function(x) {
                return x.isoCode === selectedCountryCode;
            })[0];
            // установить паттерн текущей страны по-умолчанию
            cfg.phonePattern = country.phonePattern || cfg.phonePattern;
            icaret.placeHolder = cfg.phonePattern;
            phonePatternNoAdditional = cfg.phonePattern;
            if (country.additional) {
                phonePatternAdditional = country.additional;
            }
            icaret.clearBuffer();
            icaret.initBuffer();

            this.on(input, 'paste', function(e) {
                setTimeout(function() {
                    var pos = icaret.checkVal(input, true);
                    icaret.caret(input, pos)
                }, 10)
            });

            this.on(input, 'keypress', function(e) {
                var k = e.which || e.keyCode;
                var p, c, next;

                if (e.ctrlKey || e.altKey || e.metaKey || k < 32)
                    return;

                if (k === 13 || !k)
                    return;

                var pos = icaret.caret(input);

                if (pos.begin < 1) {
                    // нельзя удалять или перезаписывать единственный символ +
                    pos.begin = 1
                }

                if (pos.end - pos.begin !== 0) {
                    icaret.clearBuffer(pos.begin, pos.end);
                    icaret.shiftL(pos.begin, pos.end - 1);
                    icaret.caret(input, Math.max(icaret.firstNonMaskPos, pos.begin))
                }


                p = icaret.seekNext(pos.begin - 1);
                if (p < icaret.len) {
                    c = String.fromCharCode(k);

                    if (icaret.tests[p].test(c)) {
                        icaret.shiftR(p);
                        icaret.buffer[p] = c;

                        icaret.writeBuffer();
                        next = icaret.seekNext(p);

                        var foundedCountry = findFirstCountry(input.value);

                        if (foundedCountry) {
                            var defaultPattern = foundedCountry.phonePattern;
                            var digits = parseInt(input.value);
                            foundedCountry.phonePattern = defaultPattern.replace(/_/g,function(m,o) {return digits[o] || "_";});
                        }
                        const newCaretBegin = changeCountry(foundedCountry, input.value);
                        if (newCaretBegin) next = newCaretBegin;
                        icaret.caret(input, next);
                    }
                }

                e.preventDefault()
            });

            this.on(input, 'focus', function(e) {
                icaret.to = setTimeout(function() {
                    for (var i = 0; i < icaret.len; i++) {
                        if (icaret.buffer[i] === '_')
                            break;
                    }

                    var pos = icaret.seekNext(i - 1);
                    icaret.caret(input, pos, pos)
                }, 60);
            });

            this.on(input, 'click', function(e) {
                icaret.to = setTimeout(function() {
                    for (var i = 0; i < icaret.len; i++) {
                        if (icaret.buffer[i] == '_')
                            break;
                    }

                    var pos = icaret.seekNext(i - 1)
                    icaret.caret(input, pos, pos)
                }, 60);
            });

            this.on(input, 'blur', function(e) {
                clearTimeout(icaret.to)
            });

            this.on(input, "keyup", function(e) {
                const evt = e || window.event;
                const keyCode = evt.keyCode;
                if (phonePatternAdditional && (keyCode === 8 || keyCode === 46 || keyCode === 127)) {
                    const formattedInputValue = formatPhone(input.value),
                        formattedPhonePattern = formatPhone(cfg.phonePattern),
                        formattedPhonePatternAdditional = formatPhone(phonePatternAdditional),
                        formattedPhonePatternNoAdditional = formatPhone(phonePatternNoAdditional);
                    if (formattedPhonePattern === formattedPhonePatternAdditional) {
                        if (!formattedInputValue.indexOf(formattedPhonePatternNoAdditional)
                            && formattedInputValue.indexOf(formattedPhonePatternAdditional)
                        ) {
                            const next = changePhonePatternCountry(phonePatternNoAdditional);
                            if (next) {
                                icaret.caret(input, next);
                            }
                        }
                    } else if (formattedPhonePattern === formattedPhonePatternNoAdditional) {
                        if (!formattedInputValue.indexOf(formattedPhonePatternAdditional)) {
                            const next = changePhonePatternCountry(phonePatternAdditional);
                            if (next) {
                                icaret.caret(input, next);
                            }
                        }
                    }
                }
            });

            this.on(input, 'keydown', function(e) {
                var pos, begin, end;
                var evt = e || window.event;
                var keyCode = evt.keyCode;
                var curVal = input.value;

                icaret.oldVal = curVal;

                if (begin < 1) {
                    // нельзя удалять единственный символ +
                    begin = 1
                }

                // left, right
                if (keyCode == 37 || keyCode == 39) {
                    e.preventDefault()
                }
                // bs, delete
                if (keyCode === 8 || keyCode === 46 || keyCode === 127) {
                    pos = icaret.caret(input);

                    begin = pos.begin;
                    end = pos.end;

                    if (begin < 1) {
                        // нельзя удалять единственный символ +
                        begin = 1
                    }

                    if (end - begin === 0) {
                        begin = keyCode !== 46 ? icaret.seekPrev(begin) : (end = icaret.seekNext(begin - 1));
                        end = keyCode === 46 ? icaret.seekNext(end) : end
                    }

                    icaret.clearBuffer(begin, end);
                    icaret.shiftL(begin, end - 1);
                    icaret.caret(input, Math.max(icaret.firstNonMaskPos, begin));
                    e.preventDefault();
                } else if (keyCode === 13) { // enter
                    if (!icaret.isValidValue(input)) return;
                    f.initCall();
                } else if (keyCode === 27) { //esc
                    f.showStep(1);

                    e.preventDefault()
                }
            });

            if ((this.isAndroid && this.isChrome) || (this.isMobile && this.isSafari)) {
                this.on(input, 'input', function(e) {
                    var curVal = input.value;
                    var pos = icaret.caret(input);
                    var p = pos.begin;

                    if (icaret.oldVal && icaret.oldVal.length && icaret.oldVal.length > curVal.length) {
                        icaret.checkVal(input, true);

                        while (p > 0 && !icaret.tests[p - 1]) {
                            p--;
                        }

                        if (p === 0) {
                            while (p < icaret.firstNonMaskPos && !icaret.tests[p]) {
                                p++;
                            }
                        }
                    } else {
                        var lastEnteredValue = curVal.charAt(p);
                        icaret.checkVal(input, true);
                        if (p < icaret.len) {
                            if (!icaret.tests[p]) {
                                p = icaret.seekNext(p)
                            }
                            if (icaret.tests[p].test(lastEnteredValue)) {
                                p = icaret.seekNext(p)
                            }
                        }
                    }

                    setTimeout(function () {
                        icaret.caret(input, p, p)
                    }, 10)
                })
            }

            icaret.writeBuffer();

            var cookie = f.getCookie('itl-cb-pages');
            if (!cookie) {
                f.setCookie('itl-cb-pages', '0', 0);
            } else {
                f.pagesViewed = parseInt(cookie);
            }

            if (cfg.leadpolicytimespent > 0) {
                f.timeSpent = 0;
                var interVal = setInterval(function() {
                    f.timeSpent += 1;
                    if (f.timeSpent >= cfg.leadpolicytimespent) {
                        clearInterval(interVal);
                        if (f.step === 1) {
                            f.showStep(2);
                            metrika.addGoal("ITL_CALLBACK_SHOW");
                        }
                    }
                }, 1000)
            }

            if (cfg.leadpolicypagesviewed > 0) {
                f.pagesViewed++;
                if (f.pagesViewed % cfg.leadpolicypagesviewed === 0) {
                    if (f.step === 1) {
                        f.showStep(2);
                        metrika.addGoal("ITL_CALLBACK_SHOW");
                    }
                }
                f.saveState();
            }

            if (cfg.leadpolicyleft) {
                var mohandler = document.onmouseout;
                document.onmouseout = function(e) {
                    if (mohandler) mohandler(e);
                    if (f.left) return;

                    var offset = window.pageYOffset;
                    var y = e.pageY;

                    if (y < offset) {
                        if (f.step === 1) {
                            f.showStep(2);
                            f.left = true;
                            metrika.addGoal("ITL_CALLBACK_SHOW");
                        }
                    }
                }
            }
        },

        saveState : function() {
            f.setCookie('itl-cb-pages', f.pagesViewed, 0);
        },

        enableCallButton: function() {
            var button = f.getElement('itlcb-do-call');

            f.removeClass(button, 'itlcb-btn-disabled');
        },

        disableCallButton: function() {
            var button = f.getElement('itlcb-do-call');

            f.addClass(button, 'itlcb-btn-disabled');
        },

        setInfoMessage: function(msg) {
            var msgBlock = f.getElement('itlcb-info-msg');

            msgBlock.innerHTML = msg;
        },

        Timer: function(seconds, el) {
            var that = {
                el: el,
                seconds: seconds,
                totalTime: (seconds * 100) + 50,
                usedTime: 0,
                startTime: +new Date(),
                timer: null
            };

            that.count = function() {
                that.usedTime = Math.floor((+new Date() - that.startTime) / 10);

                var tt = that.totalTime - that.usedTime, mi, ss;
                if (tt <= 0) {
                    that.el.innerHTML = '00:00';
                    clearInterval(that.timer);
                    f.showStep(4);
                } else {
                    mi = Math.floor(tt / (60 * 100));
                    ss = Math.floor((tt - mi * 60 * 100) / 100);
                    that.el.innerHTML = that.fillZero(mi) + ':' + that.fillZero(ss);
                }
            };
            that.init = function() {
                if (that.timer) {
                    clearInterval(that.timer);
                    that.el.innerHTML = '00:' + seconds;
                    that.totalTime = seconds * 100;
                    that.usedTime = 0;
                    that.startTime = +new Date();
                    that.timer = null;
                }
            };
            that.start = function() {
                if (!that.timer) that.timer = setInterval(that.count, 50);
            };
            that.stop = function() {
                if (that.timer) clearInterval(that.timer);
            };
            that.fillZero = function(num) {
                return num < 10 ? '0' + num : num;
            };

            return that;
        },

        showTimer: function() {
            f.callTimer = new f.Timer(cfg.timerseconds||26, f.getElement('itlcb-timer'));
            f.callTimer.start();
        },

        sendCallRequest: function(tn) {
            if (!_conn) return;
            var params = {
                '':       'callback_start',
                tn:       tn,
                uid:      cfg.uid,
                site:     window.location.origin,
                tzOffset: new Date().getTimezoneOffset(),
                visit_id: f.getRoistatVisitId(),
            };
            _conn.sendRequest(params, function(msg) {
                if (msg && msg.error) {
                    f.showStep(4, msg);
                } else if (msg && msg.email) {
                    f.showStep(4, msg);
                } else {
                    f.showStep(3);
                    f.showTimer();
                }
            });
        },

        getRoistatVisitId: function () {
            var roistatVisit = f.getCookie('roistat_visit');
            return roistatVisit ? roistatVisit : '';
        },

        initCall: function() {
            var val = f.getElement('itlcb-input').value;
            val = val.replace(/[^0-9\.]+/g, '');

            if (!_conn) {
                var wsProtocol;
                if (cfg.wsProtocol) {
                    wsProtocol = cfg.wsProtocol;
                } else {
                    wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
                }
                let url = wsProtocol + cfg.wsHost + '/ws/?_domain=' + cfg.domain;
                _conn = new APIConnection(url, {task: 'Main', useragent: window.navigator.userAgent,
                    params: {
                        platform: window.navigator.platform,
                        appId: "Callback"
                    }});
                _conn.onConnected = function() {
                    f.sendCallRequest(val)
                };
                _conn.onError = function() {
                    f.showStep(4, {error: 'INTERNAL_ERROR'})
                };
                _conn.connect()
            } else {
                f.sendCallRequest(val);
            }
        },

        getMessage: function(data) {
            var errors, email, schedule, msg;
            if (!data) data = {};
            if (cfg.widgetcode === "1") {
                errors = {
                    'INCORRECT_WEBSITE': mc("widget.incorrectWebsite"),
                    'CALL_ALREADY_SCHEDULED': mc("widget.callbackIsPlaned"),
                    'CALL_ALREADY_STARTED': mc("widget.callbackIsAlready"),
                    'CALLS_LIMIT_NUMBER': mc("widget.tooManyRequestNumber"),
                    'CALLS_LIMIT_IP': mc("widget.tooManyRequestIp")
                };
                email = mc("widget.acceptRequest");
                if (cfg.targetOfftime === "true") {
                    schedule = mc("widget.thankYouWorkingTime");
                } else {
                    schedule = mc("widget.workdayEnd") + (data.date ? mc("widget.callbackNotWorkingTime", {time: data.date}) : '');
                }
                msg = mc("widget.thankYou");
            } else if (cfg.widgetcode === "2") {
                errors = {
                    'INCORRECT_WEBSITE': mc("widget_v2.incorrectWebsite"),
                    'CALL_ALREADY_SCHEDULED': mc("widget_v2.callbackIsPlaned"),
                    'CALL_ALREADY_STARTED': mc("widget_v2.callbackIsAlready"),
                    'CALLS_LIMIT_NUMBER': mc("widget_v2.tooManyRequestNumber"),
                    'CALLS_LIMIT_IP': mc("widget_v2.tooManyRequestIp")
                };
                email = mc("widget_v2.acceptRequest");
                if (cfg.targetOfftime === "true") {
                    schedule = mc("widget_v2.thankYouWorkingTime");
                } else {
                    schedule = mc("widget_v2.workdayEnd") + (data.date ? mc("widget_v2.callbackNotWorkingTime", {time: (data.email ? '</br>' : '') + data.date}) : '');
                }
                msg = mc("widget_v2.thankYou");
            } else {
                errors = {
                    'INCORRECT_WEBSITE': mc("widget_v3.incorrectWebsite"),
                    'CALL_ALREADY_SCHEDULED': mc("widget_v3.callbackIsPlaned"),
                    'CALL_ALREADY_STARTED': mc("widget_v3.callbackIsAlready"),
                    'CALLS_LIMIT_NUMBER': mc("widget_v3.callbackIsAlready"),
                    'CALLS_LIMIT_IP': mc("widget_v3.tooManyRequestNumber")
                };
                email = mc("widget_v3.acceptRequest");
                if (cfg.targetOfftime === "true") {
                    schedule = mc("widget_v3.thankYouWorkingTime");
                } else {
                    schedule = mc("widget_v3.workdayEnd") + (data.date ? mc("widget_v3.callbackNotWorkingTime", {time: data.date}) : '');
                }
                msg = mc("widget_v3.thankYou");
            }
            if (data.error) {
                return errors[data.error] ? errors[data.error] : mc("widget.internalError");
            } else if (data.schedule) {
                return schedule;
            } else if (data.email) {
                return email;
            } else {
                return msg;
            }
        },

        showStep: function(step, data) {
            f.step = step;
            if (step === 1) {
                f.show('itlcb-call-btn');

                f.hide('itlcb-bg-fill');
                f.hide('itlcb-step2').animation(f.typeAnimation);
                f.hide('itlcb-step3');
                f.hide('itlcb-step4');
            } else if (step === 2) {
                f.show('itlcb-bg-fill');
                f.show('itlcb-step2').animation(f.typeAnimation);

                f.hide('itlcb-step3');
                f.hide('itlcb-step4');
                f.hide('itlcb-call-btn');
            } else if (step === 3) {
                f.show('itlcb-bg-fill');
                f.show('itlcb-step3');

                f.hide('itlcb-step2');
                f.hide('itlcb-step4');
                f.hide('itlcb-call-btn');
            } else if (step === 4) {
                f.show('itlcb-bg-fill');
                f.show('itlcb-step4');

                f.hide('itlcb-step2');
                f.hide('itlcb-step3');
                f.hide('itlcb-call-btn');
                var msgBlock = f.getElement('itlcb-msg-wrap');
                f.removeClass(msgBlock, 'itlcb-error');
                f.removeClass(msgBlock, 'itlcb-not-working');
                if (f.callTimer) f.callTimer.stop();
                if (data && data.error) {
                    if (data.error === 'NOT_WORKING_TIME') {
                        this.setInfoMessage(this.getMessage({ schedule: true, date: data.date, email: data.email }));
                        f.addClass(msgBlock, 'itlcb-not-working');
                    } else {
                        this.setInfoMessage(this.getMessage({ error: data.error }));
                        f.addClass(msgBlock, 'itlcb-error');
                    }
                } else if (data && data.email) {
                    this.setInfoMessage(this.getMessage({ email: data.email }));
                } else {
                    this.setInfoMessage(this.getMessage());
                }
            }
        }
    };

    if (cfg.enabled) {
        f.appendStyle();
        f.initWidget()
    }

})(document);
